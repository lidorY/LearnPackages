name: Push Docker Image
decription: 'Build and push to GitHub package a specified docker image'


inputs:
  docker-file-path: 
    description: 'Dockerfile path to build the image from.'
    required: true
  image-name: 
    description: 'The name of the image that will be generated'
    required: true
  # Since we can;t access the repository env variables from inside an action
  #   we provide them as these variables.
  username: 
    description: 'The github user name. Should ALWAYS be: github.actor'
    required: true
  password: 
    description: 'The github user name. Should ALWAYS be: secrets.GITHUB_TOKEN'
    required: true

runs:
  using: 'composite'
  steps:
    - uses: docker/login-action@v2
      with:
        # The GitHub package regitry URL
        registry: ghcr.io
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}
    - id: meta
      uses: docker/metadata-action@v4
      with:
        images: |
          ghcr.io/${{ github.repository }}/${{ inputs.image-name}}
        github-token: ${{ inputs.password }}
    - uses: docker/build-push-action@v3
      with:
        push: true
        file: "${{ inputs.docker-file-path}}"
        tags: ${{ steps.meta.outputs.tags }}
